#analyze_file.py

import json
import os
import subprocess
import sys

def run_strings(file_path):
    try:
        result = subprocess.run(['strings', file_path], capture_output=True, text=True, check=True)
        strings_output = result.stdout.splitlines()
        return strings_output
    except subprocess.CalledProcessError as e:
        print(f"Error running strings command: {e}", file=sys.stderr)
        return []

def main(file_path):
    if not os.path.exists(file_path):
        print(f"File {file_path} does not exist.", file=sys.stderr)
        sys.exit(1)

    strings_output = run_strings(file_path)

    output = {
        "file": file_path,
        "strings": strings_output
    }

    json_file_path = f"{file_path}.json"
    with open(json_file_path, 'w') as json_file:
        json.dump(output, json_file, indent=4)

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 analyze_file.py <file_path>", file=sys.stderr)
        sys.exit(1)

    file_path = sys.argv[1]
    main(file_path)
