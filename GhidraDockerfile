FROM ubuntu:18.04

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive
ENV GHIDRA_PATH=/home/app/ghidra
ENV GHIDRA_URL=https://github.com/NationalSecurityAgency/ghidra/releases/download/Ghidra_11.1.2_build/ghidra_11.1.2_PUBLIC_20240709.zip


# Install required packages
RUN apt-get update && apt-get install -y \
    python2.7 \
    python2.7-dev \
    python-pip \
    openjdk-11-jdk \
    wget \
    unzip \
    bash \
    && apt-get clean

# Install Python packages
RUN python2.7 -m pip install networkx

# Create the working directory
RUN mkdir -p /home/app
WORKDIR /home/app

# Download and extract Ghidra
RUN wget -q ${GHIDRA_URL} -O /home/app/ghidra.zip && \
    if [ $? -ne 0 ]; then echo "Failed to download Ghidra"; exit 1; fi && \
    unzip -q /home/app/ghidra.zip -d /home/app/ && \
    if [ $? -ne 0 ]; then echo "Failed to unzip Ghidra"; exit 1; fi && \
    mv /home/app/ghidra_10.2.3_PUBLIC /home/app/ghidra && \
    rm /home/app/ghidra.zip && \
    echo "Ghidra setup completed successfully"

# Copy scripts to the container
COPY fromsnippets.py /home/app/
COPY process_malware.sh /home/app/
COPY runGhidra.sh /home/app/

# Make the scripts executable
RUN chmod +x /home/app/process_malware.sh /home/app/runGhidra.sh

# Set the entrypoint to keep the container running
CMD ["sleep", "infinity"]
