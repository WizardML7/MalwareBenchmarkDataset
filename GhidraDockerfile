FROM ubuntu:latest

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive
ENV GHIDRA_VERSION=10.2.3_PUBLIC
ENV GHIDRA_PATH=/home/app/ghidra

# Install required packages
RUN apt-get update && apt-get install -y \
    python-is-python2 \
    python2-dev \
    python-pip-whl \
    openjdk-11-jdk \
    wget \
    unzip \
    bash \
    && apt-get clean

# Install Python packages
RUN python2 -m ensurepip && \
    python2 -m pip install networkx

# Create the working directory
RUN mkdir -p /home/app
WORKDIR /home/app

# Download and extract Ghidra
RUN wget https://ghidra-sre.org/ghidra_${GHIDRA_VERSION}.zip -O /home/app/ghidra.zip && \
    unzip /home/app/ghidra.zip -d /home/app/ && \
    mv /home/app/ghidra_${GHIDRA_VERSION} /home/app/ghidra && \
    rm /home/app/ghidra.zip

# Copy scripts to the container
COPY fromsnippets.py /home/app/
COPY process_malware.sh /home/app/
COPY runGhidra.sh /home/app/

# Make the scripts executable
RUN chmod +x /home/app/process_malware.sh /home/app/runGhidra.sh

# Set the entrypoint to keep the container running
CMD ["sleep", "infinity"]
