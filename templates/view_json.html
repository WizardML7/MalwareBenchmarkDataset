<!-- view_json.html -->
{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>JSON Results</h1>
    <pre id="json-renderer">{{ analysis_results }}Here is the pre line</pre>
    <h2>This is to see if the results are in between</h2>
    <a href="{{ url_for('main.download') }}" class="btn btn-primary">Back to Downloads</a>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    try {
        var jsonString = '{{ analysis_results|tojson|safe }}';

        // Sanitize JSON string by removing control characters
        jsonString = jsonString.replace(/[\x00-\x1F\x7F-\x9F]/g, '');

        // Log sanitized JSON string
        console.log("Sanitized JSON String:", jsonString);

        var jsonData = JSON.parse(jsonString);

        // Log parsed JSON data
        console.log("Parsed JSON Data:", jsonData);

        $('#json-renderer').jsonViewer(jsonData, {collapsed: true, withQuotes: true});
    } catch (e) {
        console.error("Error parsing JSON data:", e);
    }
});
</script>
{% endblock %}
