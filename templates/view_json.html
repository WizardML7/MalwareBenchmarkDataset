<!-- view_json.html -->
{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>JSON Results</h1>
    <pre id="json-renderer"></pre>
    <a href="{{ url_for('main.download') }}" class="btn btn-primary">Back to Downloads</a>
    <pre id="test-renderer"></pre>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/json-viewer/1.1.0/jquery.json-viewer.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/json-viewer/1.1.0/jquery.json-viewer.min.css" />

<script>
$(document).ready(function() {
    try {
        // Fetch JSON data from the server
        var jsonString = '{{ analysis_results|tojson|safe }}';

        // Clean up the JSON string
        jsonString = jsonString.replace(/[\x00-\x1F\x7F-\x9F]/g, '');

        // Parse JSON and handle errors
        try {
            var jsonData = JSON.parse(jsonString);
            $('#json-renderer').jsonViewer(jsonData, {collapsed: true, withQuotes: true});
        } catch (e) {
            console.error("Error parsing JSON data:", e);
            $('#json-renderer').text('Error parsing JSON data. Please check the format.');
        }

        // Create a JavaScript dictionary
        var data = {
            "foobar": "foobaz"
        };

        // Display the JavaScript dictionary
        $('#test-renderer').jsonViewer(data, {collapsed: true, withQuotes: true});
    } catch (e) {
        console.error("Unexpected error:", e);
        $('#json-renderer').text('Unexpected error occurred while processing JSON data.');
    }
});
</script>
{% endblock %}
