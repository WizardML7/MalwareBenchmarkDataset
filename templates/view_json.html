<!-- view_json.html -->
{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>JSON Results</h1>
    <div class="json-container">
        <pre id="json-renderer"></pre>
    </div>
    <a href="{{ url_for('main.download') }}" class="btn btn-primary">Back to Downloads</a>
</div>
{% endblock %}

{% block styles %}
<style>
    .json-container {
        max-height: 500px; /* Adjust as needed */
        overflow-y: auto;
        border: 1px solid #ddd;
        padding: 10px;
        background-color: #f9f9f9;
        margin-top: 20px;
    }
    #json-renderer {
        white-space: pre-wrap; /* Allows text wrapping */
        word-wrap: break-word; /* Ensure long words are wrapped */
    }
    
    /* Ensure button is styled correctly */
    .btn-primary {
        background-color: #3498db; /* Button background color */
        color: #fff; /* Button text color */
        border: none; /* Remove default border */
        padding: 10px 20px; /* Add padding */
        font-size: 1rem; /* Font size */
        cursor: pointer; /* Pointer cursor on hover */
        border-radius: 5px; /* Rounded corners */
        transition: background-color 0.3s ease, transform 0.3s ease; /* Smooth transitions */
    }
    
    .btn-primary:hover {
        background-color: #2980b9; /* Darker background on hover */
        transform: scale(1.05); /* Slightly scale up on hover */
    }
</style>
{% endblock %}

{% block scripts %}

<script>
$(document).ready(function() {
    try {
        var jsonString = '{{ analysis_results }}';

        // Replace HTML entities with actual characters
        jsonString = jsonString.replace(/&#39;/g, '"');

        // Clean up the JSON string
        jsonString = jsonString.replace(/[\x00-\x1F\x7F-\x9F]/g, '');

        try {
            var jsonData = JSON.parse(jsonString);
            $('#json-renderer').jsonViewer(jsonData);
        } catch (e) {
            console.error("Error parsing JSON data:", e);
            $('#json-renderer').text('Error parsing JSON data. Please check the format.');
        }
    } catch (e) {
        console.error("Unexpected error:", e);
        $('#json-renderer').text('Unexpected error occurred while processing JSON data.');
    }
});
</script>
{% endblock %}
